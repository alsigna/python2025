# Redis

- [Redis](#redis)
  - [Описание](#описание)
  - [Типы данных](#типы-данных)
    - [String](#string)
    - [List](#list)
    - [Set](#set)
    - [Hash](#hash)
    - [Sorted Set (ZSet)](#sorted-set-zset)
    - [Bitmap](#bitmap)
    - [Stream](#stream)
  - [Блокировка сервера](#блокировка-сервера)
  - [Альтернативы](#альтернативы)
  - [Redis Queue](#redis-queue)

## Описание

Redis (REmote DIctionary Server) — это in-memory (данные хранятся в оперативной памяти) хранилище структурированных данных, часто используемое как кеш, брокер сообщений, база данных или очередь. Написан на C и отличается быстротой, благодаря чему используется даже в тех системах, где задержка критична. Поддерживает различные структуры данных, такие как строки, списки, множества, хэши и другие.

| Преимущество | Описание |
| - | - |
| Скорость | Всё хранится в памяти, миллионы операций в секунду |
| Типы данных | Поддержка сложных структур: списки, множества, стримы |
| Простота | Простая установка, CLI, библиотеки под популярные ЯП |
| TTL/expiring | Возможность задавать срок жизни ключей |
| Atomic | Все операции атомарны |
| Persistence | Есть возможность сохранять данные на диск |
| Модули | Поддержка модулей: RedisJSON, RediSearch и др. |
| Резервирование | Sentinel/HA Cluster |

## Типы данных

### String

string - базовый тип ключ-значение. Значение может быть строкой, числом, JSON/сериализованным объектом. Поддерживает операции над строками и числами.

### List

list — упорядоченный список строк.

### Set

Элементы уникальны, порядок не сохраняется (как set в python). Быстрые проверки принадлежности, пересечения, объединения.

### Hash

массив, словарь. Подходит для хранения объекта/структуры/словаря.

### Sorted Set (ZSet)

Упорядоченное множество с приоритетом. Каждому элементу ставится числовой приоритет (score), по которому происходит упорядочивание элементов, поддерживает выборку по рангу или диапазону.

### Bitmap

Работа с битами, позволяет устанавливать/считывать отдельные биты. Подходит для трекинга флагов, уникальных посещений и т.п.

### Stream

Поток упорядоченных сообщений с уникальными идентификаторами (ID). Можно добавлять подписчиков. Поход на kafka, но проще и встроен в redis.

## Блокировка сервера

Redis - однопоточный сервер, и если операции выполняются на больших объемах данных, то это может блокировать сервер для других обращений. В документации практически везде указана сложность операций и это нужно учитывать. Например KEYS * это O(N) операция и при большом числе записей может блокировать сервер. Для staging не важно, но в production среде KEYS не нужно использовать. Есть альтернатива SCAN, которая работает за O(1), возвращает порцию данных и отдает управление. Аналогично с xRANGE, xMEMBERS и другими командами, если структура большая, то лучше использовать пагинацию (вместо 0, -1) и получать данные частями.

## Альтернативы

- [DragonflyDB](https://www.dragonflydb.io) — быстрая альтернатива Redis, полностью open-source
- [KeyDB](https://docs.keydb.dev) — форк Redis с многопоточностью
- [Valkey](https://valkey.io) — форк Redis от сообщества, поддерживаемый Linux Foundation

## Redis Queue

rq это библиотека для фонового выполнения задач в Python с использованием Redis как брокера. Популярна для очередей задач в Django/Flask-проектах. Является легковесной альтернативой Celery.

```text
APP <-- enqueue(job) --> Redis <--> Worker
```

Redis — выступает как брокер + очередь.
enqueue — приложение ставит задачу в Redis
worker — отдельный процесс, который забирает задачи из Redis и выполняет их

Плюсы:

- простота, один redis без дополнительных брокеров
- python код без дополнительных DSL
- подходит для небольших низконагруженных приложений
- есть возможность запуска по расписанию (rq-scheduler)
- поддержка нескольких очередей

Минусы:

- работает только с redis
- не подходит для нагруженных систем
- нет распределенной отказоустойчивости
